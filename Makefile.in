prefix=@prefix@
INSTALL=@INSTALL@
DESTDIR=
RTSS=$(wildcard rts*)

export prefix INSTALL DESTDIR RTSS

SRC   = @SRC@

DEST  = timberc

LIB_T  = $(wildcard lib/*.t)
LIB_TI = $(LIB_T:.t=.ti)
LIB_C  = $(LIB_T:.t=.c)
LIB_H  = $(LIB_T:.t=.h)

all: rts

rts: $(DEST)
	@for rts in $(RTSS); do \
		echo Making $$rts; \
		$(MAKE) -C $$rts; \
	done

install: ${DEST}
	$(INSTALL) -d $(DESTDIR)$(prefix)/bin
	$(INSTALL) -d $(DESTDIR)$(prefix)/lib
	$(INSTALL) -d $(DESTDIR)$(prefix)/include
	$(INSTALL) timberc $(DESTDIR)$(prefix)/bin
	$(INSTALL) lib/* $(DESTDIR)$(prefix)/lib
	$(INSTALL) include/timber.h $(DESTDIR)$(prefix)/include
	@for rts in $(RTSS); do \
		echo Installing $$rts; \
		$(MAKE) install -C $$rts; \
	done

clean: libclean
	rm -f *.o *.hi $(DEST) 
	
libclean:
	rm -f $(LIB_TI) $(LIB_C) $(LIB_H)
	@for rts in $(RTSS); do \
		echo Cleaning $$rts; \
		$(MAKE) clean -C $$rts; \
	done

distclean: clean
	rm -f Makefile config.h	
	@for rts in $(RTSS); do \
		echo Distcleaning $$rts; \
		$(MAKE) distclean -C $$rts; \
	done

